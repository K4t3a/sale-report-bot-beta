# Sales Report Bot (Beta) ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Telegram-–±–æ—Ç–∞ –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∂

–ë–µ—Ç–∞-–≤–µ—Ä—Å–∏—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: **web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + backend API + Telegram-–±–æ—Ç**, –∫–æ—Ç–æ—Ä–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç:
- —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º (—Å–≤–æ–¥–∫–∞ + CSV),
- –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π —Ä–∞—Å—Å—ã–ª–∫–∏,
- –¥–æ—Å—Ç–∞–≤–∫—É –æ—Ç—á—ë—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ Telegram.

---

## ‚ú® –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ beta

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (Web)**:
  - –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (JWT –≤—ã–¥–∞—ë—Ç—Å—è –Ω–∞ –ª–æ–≥–∏–Ω–µ),
  - –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–æ–≤,
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π (DAILY/WEEKLY, –≤—Ä–µ–º—è, –ø–æ–ª—É—á–∞—Ç–µ–ª–∏),
  - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–æ—Å—Ç–∞–≤–æ–∫,
  - –≥—Ä–∞—Ñ–∏–∫ –≤—ã—Ä—É—á–∫–∏ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º).

- **Backend API (Node.js/Express + PostgreSQL)**:
  - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã (today / last7days / last30days),
  - —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV (–≤ —Ç.—á. ‚Äú—à–∞–ø–∫–∞‚Äù —Å–æ —Å–≤–æ–¥–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏),
  - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ ‚Äú–∫—Ç–æ –¥–æ–ª–∂–µ–Ω —É–π—Ç–∏ —Å–µ–π—á–∞—Å‚Äù (`/api/schedules/run-due`),
  - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–æ–∫ (–¥–ª—è –∞–Ω—Ç–∏-–¥—É–±–ª–µ–π),
  - healthcheck.

- **Telegram-–±–æ—Ç (Telegraf)**:
  - –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ‚Äú–∫–æ–¥—É‚Äù (–≤ beta –∫–æ–¥ = `username` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î),
  - –∫–æ–º–∞–Ω–¥–∞ `/today` ‚Äî –æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è (—Å–æ–æ–±—â–µ–Ω–∏–µ + —Ñ–∞–π–ª `.csv.gz`),
  - –∫–æ–º–∞–Ω–¥–∞ `/reports` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏,
  - polling —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –∏ —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Ç—á—ë—Ç–æ–≤.

---

##  –°—Ç–µ–∫

- **Backend:** Node.js + TypeScript, Express, pg, bcrypt, jsonwebtoken
- **DB:** PostgreSQL
- **Frontend:** React (Vite) + React Router + Recharts
- **Bot:** Telegraf + axios
- **–¢–µ—Å—Ç—ã:** Jest (–±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
sales-report-bot-beta/
  backend/     # REST API + –º–∏–≥—Ä–∞—Ü–∏–∏ + seed
  frontend/    # –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (React)
  bot/         # Telegram-–±–æ—Ç (Telegraf)
  docker-compose.yml  # PostgreSQL 
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç 

### 0) –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js **18+** (–ª—É—á—à–µ 20/22)
- Docker Desktop (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å docker-compose)
- npm

---

### 1) –ü–æ–¥–Ω—è—Ç—å PostgreSQL
–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
docker compose up -d
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î –∏–∑ `docker-compose.yml`:
- DB: `sales`
- user: `sales_user`
- pass: `sales_pass`
- port: `5432`

---

### 2) Backend ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ + —Å–∏–¥ + –∑–∞–ø—É—Å–∫
```bash
cd backend
npm i
```

#### –ù–∞—Å—Ç—Ä–æ–π `.env` (backend/.env)
–î–ª—è docker-compose —É–¥–æ–±–Ω–æ —Ç–∞–∫:
```env
PORT=4000
JWT_SECRET=dev-secret
DATABASE_URL=postgresql://sales_user:sales_pass@127.0.0.1:5432/sales

ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin

SEED_COUNT=50000
SEED_DAYS=30
```

#### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏
```bash
npm run migrate
npm run seed
```

#### –ó–∞–ø—É—Å–∫ backend
```bash
npm run dev
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
- `GET http://localhost:4000/api/health`

> –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Å—Ç–æ `http://localhost:4000/` ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç—Å—è `–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω` (–≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç ‚Äú–≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã‚Äù –Ω–∞ backend).

---

### 3) Frontend ‚Äî –∑–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
```bash
cd ../frontend
npm i
```

–°–æ–∑–¥–∞–π `frontend/.env` (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –¥–µ—Ñ–æ–ª—Ç):
```env
VITE_API_BASE_URL=http://localhost:4000
```

–ó–∞–ø—É—Å–∫:
```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π:
- `http://localhost:5173` (–∏–ª–∏ –∞–¥—Ä–µ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∂–µ—Ç Vite)

–õ–æ–≥–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- **admin / admin** (—Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∏–¥–æ–º)

---

### 4) Bot ‚Äî –∑–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞
```bash
cd ../bot
npm i
```

–°–æ–∑–¥–∞–π `bot/.env`:
```env
BOT_TOKEN=PASTE_YOUR_TOKEN_HERE
BACKEND_BASE_URL=http://localhost:4000
```

–ó–∞–ø—É—Å–∫:
```bash
npm run dev
```

---


## üóÑÔ∏è –ö–∞–∫ –∑–∞—Å–∏–¥–∏—Ç—å 100 000 –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–¥–∞–∂

–°–∏–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–æ—á–∏—â–∞–µ—Ç** —Ç–∞–±–ª–∏—Ü—É `sale_demo` –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∑–∞–Ω–æ–≤–æ.

1) –í `backend/.env`:
```env
SEED_COUNT=100000
```

2) –ó–∞–ø—É—Å—Ç–∏:
```bash
cd backend
npm run seed
```

---

## ‚è±Ô∏è –†–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ —Ä–∞—Å—Å—ã–ª–∫–∞

- –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏, –≤—ã–±–∏—Ä–∞—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞ **—É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö** Telegram-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –ë–æ—Ç –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –¥–µ–ª–∞–µ—Ç POST:
  - `POST /api/schedules/run-due`
- Backend:
  - –∏—â–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É,
  - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ, –µ—Å–ª–∏ –≤ —ç—Ç—É –º–∏–Ω—É—Ç—É —É–∂–µ –µ—Å—Ç—å `SUCCESS` –≤ `delivery_logs`.

---

## üîå –û—Å–Ω–æ–≤–Ω—ã–µ API 

- `GET /api/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ API + DB
- `POST /api/auth/login` ‚Äî –ª–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (JWT)
- `GET /api/reports` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
- `POST /api/reports/daily-sales` ‚Äî –æ—Ç—á—ë—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥ (today/last7days/last30days)
- `POST /api/reports/:id/run` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç—á—ë—Ç –ø–æ id
- `GET /api/analytics/sales-by-day?days=7` ‚Äî –≤—ã—Ä—É—á–∫–∞/–∑–∞–∫–∞–∑—ã/–∫–æ–ª-–≤–æ –ø–æ –¥–Ω—è–º
- `GET /api/schedules` ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
- `POST /api/schedules` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `DELETE /api/schedules/:id` ‚Äî —É–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `POST /api/schedules/run-due` ‚Äî ‚Äú—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å‚Äù (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ—Ç)
- `POST /api/users/telegram-bind` ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram –ø–æ –∫–æ–¥—É (username)
- `GET /api/users/telegram` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å telegram_id
- `GET /api/logs?limit=50` ‚Äî –ª–æ–≥–∏ –¥–æ—Å—Ç–∞–≤–æ–∫

---

## ‚úÖ –¢–µ—Å—Ç—ã (backend)

```bash
cd backend
npm test
```

### –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (Linux/macOS)
```bash
DATABASE_URL="postgresql://sales_user:sales_pass@127.0.0.1:5432/sales" npm test
```

### PowerShell (Windows)
```powershell
$env:DATABASE_URL="postgresql://sales_user:sales_pass@127.0.0.1:5432/sales"; npm test
```


##  Roadmap 
- –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT middleware + —Ä–æ–ª–∏)
- –†–µ–∞–ª—å–Ω—ã–π ‚Äú–∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏‚Äù (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω/–∏–Ω–≤–∞–π—Ç, –∞ –Ω–µ username)
- –≠–∫—Å–ø–æ—Ä—Ç PDF/XLSX
- –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è/–¥–æ—Å—Ç–∞–≤–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (CRM/1–°/Google Sheets)
